<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.37.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.8.0">
  <bpmn:process id="Process_0j5qzil" name="Agent Blueprint (Long Term Memory)" isExecutable="true">
    <bpmn:exclusiveGateway id="Gateway_1k7euae" name="action needed?">
      <bpmn:incoming>Flow_1imcl82</bpmn:incoming>
      <bpmn:outgoing>Flow_6</bpmn:outgoing>
      <bpmn:outgoing>Flow_105bcld</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="Event_ProcessEnd" name="Case resolution applied by human">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:output source="=agent.context.metrics.tokenUsage.inputTokenCount" target="metrics_inputTokenCount" />
          <zeebe:output source="=agent.context.metrics.tokenUsage.outputTokenCount" target="metrics_outputTokenCount" />
          <zeebe:output source="=agent.context.metrics.modelCalls" target="metrics_modelCalls" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0v6pwqf</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="Gateway_1j0oz23">
      <bpmn:incoming>Flow_1jfjd7m</bpmn:incoming>
      <bpmn:incoming>Flow_04nch0z</bpmn:incoming>
      <bpmn:outgoing>Flow_0l610js</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:adHocSubProcess id="Activity_04glkkx" name="Tools available to AI agent">
      <bpmn:extensionElements>
        <zeebe:adHoc activeElementsCollection="=[toolCall._meta.name]" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_6</bpmn:incoming>
      <bpmn:outgoing>Flow_1jfjd7m</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:extensionElements>
          <zeebe:loopCharacteristics inputCollection="=agent.toolCalls" inputElement="toolCall" outputCollection="toolResults" outputElement="={&#10;  id: toolCall._meta.id,&#10;  name: toolCall._meta.name,&#10;  content: toolResult&#10;}" />
        </bpmn:extensionElements>
      </bpmn:multiInstanceLoopCharacteristics>
      <bpmn:serviceTask id="Reply_with_email_to_customer" name="Ask customer via email" zeebe:modelerTemplate="io.camunda.connectors.email.v1" zeebe:modelerTemplateVersion="2" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:documentation>Use this activity to reply to the customer via email to ask questions and clarify requirements.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:email:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="simple" target="authentication.type" />
            <zeebe:input source="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_USERNAME}}" target="authentication.username" />
            <zeebe:input source="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_PASSWORD}}" target="authentication.password" />
            <zeebe:input source="smtp" target="protocol" />
            <zeebe:input source="smtp.gmail.com" target="data.smtpConfig.smtpHost" />
            <zeebe:input source="=587" target="data.smtpConfig.smtpPort" />
            <zeebe:input source="TLS" target="data.smtpConfig.smtpCryptographicProtocol" />
            <zeebe:input source="sendEmailSmtp" target="data.smtpActionDiscriminator" />
            <zeebe:input source="your-adress@gmail.com" target="data.smtpAction.from" />
            <zeebe:input source="=currentEmail.fromAddress" target="data.smtpAction.to" />
            <zeebe:input source="={&#10;  &#34;In-Reply-To&#34;: currentEmail.messageId&#10;}" target="data.smtpAction.headers" />
            <zeebe:input source="=&#34;RE: &#34; + currentEmail.subject" target="data.smtpAction.subject" />
            <zeebe:input source="PLAIN" target="data.smtpAction.contentType" />
            <zeebe:input source="=fromAi(toolCall.emailContent, &#34;The email text content to reply the customer&#34;)" target="data.smtpAction.body" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="resultVariable" value="ourReplyEmail" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_0yjq5t1</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:intermediateCatchEvent id="Event_WaitForResponse" name="Customer response received" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailIntermediate.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
        <bpmn:extensionElements>
          <zeebe:properties>
            <zeebe:property name="inbound.type" value="io.camunda:connector-email-inbound:1" />
            <zeebe:property name="authentication.type" value="simple" />
            <zeebe:property name="authentication.username" value="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_USERNAME}}" />
            <zeebe:property name="authentication.password" value="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_PASSWORD}}" />
            <zeebe:property name="data.imapConfig.imapHost" value="imap.gmail.com" />
            <zeebe:property name="data.imapConfig.imapPort" value="993" />
            <zeebe:property name="data.imapConfig.imapCryptographicProtocol" value="TLS" />
            <zeebe:property name="data.pollingWaitTime" value="PT10S" />
            <zeebe:property name="data.pollingConfigDiscriminator" value="unseenPollingConfig" />
            <zeebe:property name="data.pollingConfig.handlingStrategy" value="READ" />
            <zeebe:property name="activationCondition" value="=not(is empty(headers[key = &#34;In-Reply-To&#34;]))" />
            <zeebe:property name="consumeUnmatchedEvents" value="false" />
            <zeebe:property name="correlationKeyExpression" value="=headers[key = &#34;In-Reply-To&#34;][1].value" />
            <zeebe:property name="deduplicationModeManualFlag" value="true" />
            <zeebe:property name="deduplicationId" value="sample-agent-reply-to-emails" />
            <zeebe:property name="deduplicationMode" value="MANUAL" />
            <zeebe:property name="resultVariable" value="responseEmail" />
            <zeebe:property name="resultExpression" value="" />
          </zeebe:properties>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_0yjq5t1</bpmn:incoming>
        <bpmn:outgoing>Flow_11xrx39</bpmn:outgoing>
        <bpmn:messageEventDefinition id="MessageEventDefinition_08tkzj2" messageRef="Message_06f2bma" />
      </bpmn:intermediateCatchEvent>
      <bpmn:userTask id="Ask_a_specialist" name="Ask loan specialist">
        <bpmn:documentation>Use this activity when you are not confident with having enough information to successfully assist the customer and want to have advise on loan from a specialist.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:userTask />
          <zeebe:ioMapping>
            <zeebe:input source="=fromAi(toolCall.requestToHuman, &#34;Describe what you need advise on from a specialist&#34;, &#34;string&#34;)" target="requestDetails" />
            <zeebe:output source="=responseToRequest" target="toolResult" />
            <zeebe:output source="=knowledgeBaseDecision" target="knowledgeBaseDecision" />
            <zeebe:output source="=taking_full_control" target="taking_full_control" />
          </zeebe:ioMapping>
          <zeebe:formDefinition formId="Form_0gkm2u8" />
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_1aaxb1w</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:serviceTask id="Activity_062h34x" name="Save&#10;answer in knowledge base" zeebe:modelerTemplate="io.camunda.connectors.EmbeddingsVectorDB.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="OPERATION_EMBED_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
            <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="embeddingModelProvider.accessKey" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
            <zeebe:input source="=aws_configuration.region" target="embeddingModelProvider.region" />
            <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
            <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
            <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
            <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
            <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="vectorStore.accessKey" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
            <zeebe:input source="aws_configuration.longterm_memory_server_url" target="vectorStore.serverUrl" />
            <zeebe:input source="=aws_configuration.region" target="vectorStore.region" />
            <zeebe:input source="specialist-knowledge-base" target="vectorStore.indexName" />
            <zeebe:input source="PlainText" target="vectorDatabaseConnectorOperation.documentSource" />
            <zeebe:input source="=toolResult" target="vectorDatabaseConnectorOperation.documentSourceFromProcessVariable" />
            <zeebe:input source="DOCUMENT_SPLITTER_RECURSIVE" target="vectorDatabaseConnectorOperation.documentSplitter.splitterType" />
            <zeebe:input source="=500" target="vectorDatabaseConnectorOperation.documentSplitter.maxSegmentSizeInChars" />
            <zeebe:input source="=80" target="vectorDatabaseConnectorOperation.documentSplitter.maxOverlapSizeInChars" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="elementTemplateVersion" value="1" />
            <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1mudddl</bpmn:incoming>
        <bpmn:outgoing>Flow_0j63wm9</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:serviceTask id="query_knowledge_base" name="Query&#10;knowledge base" zeebe:modelerTemplate="io.camunda.connectors.EmbeddingsVectorDB.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
        <bpmn:documentation>Use this activity to search company knowledge base for general answers</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
          <zeebe:ioMapping>
            <zeebe:input source="OPERATION_RETRIEVE_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
            <zeebe:input source="=fromAi(toolCall.query, &#34;The knowledge base query you want to perform&#34;)" target="vectorDatabaseConnectorOperation.query" />
            <zeebe:input source="=5" target="vectorDatabaseConnectorOperation.documentLimit" />
            <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="embeddingModelProvider.accessKey" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
            <zeebe:input source="=aws_configuration.region" target="embeddingModelProvider.region" />
            <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
            <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
            <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
            <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
            <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="vectorStore.accessKey" />
            <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
            <zeebe:input source="=aws_configuration.longterm_memory_server_url" target="vectorStore.serverUrl" />
            <zeebe:input source="=aws_configuration.region" target="vectorStore.region" />
            <zeebe:input source="specialist-knowledge-base" target="vectorStore.indexName" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="elementTemplateVersion" value="1" />
            <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
            <zeebe:header key="resultVariable" value="toolResult" />
            <zeebe:header key="errorExpression" value="=if contains(error.message, &#34;index_not_found&#34;) then bpmnError(&#34;index_not_found&#34;, &#34;The index does not exist&#34;) else null" />
            <zeebe:header key="retryBackoff" value="PT0S" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
      </bpmn:serviceTask>
      <bpmn:intermediateThrowEvent id="Event_0wh5ha7" name="ignore">
        <bpmn:incoming>Flow_0d4itte</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:exclusiveGateway id="Gateway_1whb5u5" name="Save answer to Knowledge base">
        <bpmn:incoming>Flow_0acq6om</bpmn:incoming>
        <bpmn:outgoing>Flow_1mudddl</bpmn:outgoing>
        <bpmn:outgoing>Flow_0lexqwn</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:intermediateThrowEvent id="Event_1wd6fel" name="Specialist answered">
        <bpmn:incoming>Flow_0j63wm9</bpmn:incoming>
        <bpmn:incoming>Flow_0lexqwn</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:exclusiveGateway id="Gateway_1g2difp" name="Who keeps control?">
        <bpmn:incoming>Flow_1aaxb1w</bpmn:incoming>
        <bpmn:outgoing>Flow_0acq6om</bpmn:outgoing>
        <bpmn:outgoing>Flow_0q6oul9</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:intermediateThrowEvent id="Event_0xzg3s4" name="Human control required">
        <bpmn:incoming>Flow_0q6oul9</bpmn:incoming>
        <bpmn:escalationEventDefinition id="EscalationEventDefinition_1h6o509" escalationRef="Escalation_1x4421v" />
      </bpmn:intermediateThrowEvent>
      <bpmn:intermediateThrowEvent id="Event_0jmzwhr" name="Response correlated">
        <bpmn:extensionElements>
          <zeebe:ioMapping>
            <zeebe:output source="=responseEmail" target="toolResult" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_11xrx39</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:boundaryEvent id="Event_1wezv96" name="knowledge base empty" attachedToRef="query_knowledge_base">
        <bpmn:outgoing>Flow_0d4itte</bpmn:outgoing>
        <bpmn:errorEventDefinition id="ErrorEventDefinition_07papr1" errorRef="Error_04dhtpa" />
      </bpmn:boundaryEvent>
      <bpmn:sequenceFlow id="Flow_0yjq5t1" sourceRef="Reply_with_email_to_customer" targetRef="Event_WaitForResponse" />
      <bpmn:sequenceFlow id="Flow_11xrx39" sourceRef="Event_WaitForResponse" targetRef="Event_0jmzwhr" />
      <bpmn:sequenceFlow id="Flow_1aaxb1w" sourceRef="Ask_a_specialist" targetRef="Gateway_1g2difp" />
      <bpmn:sequenceFlow id="Flow_1mudddl" name="yes" sourceRef="Gateway_1whb5u5" targetRef="Activity_062h34x">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=knowledgeBaseDecision = "yes"</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0j63wm9" sourceRef="Activity_062h34x" targetRef="Event_1wd6fel" />
      <bpmn:sequenceFlow id="Flow_0d4itte" sourceRef="Event_1wezv96" targetRef="Event_0wh5ha7" />
      <bpmn:sequenceFlow id="Flow_0acq6om" name="agent" sourceRef="Gateway_1g2difp" targetRef="Gateway_1whb5u5">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=not(taking_full_control)</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0lexqwn" name="no" sourceRef="Gateway_1whb5u5" targetRef="Event_1wd6fel">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=knowledgeBaseDecision = "no"</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0q6oul9" name="specialist" sourceRef="Gateway_1g2difp" targetRef="Event_0xzg3s4">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=taking_full_control</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
    </bpmn:adHocSubProcess>
    <bpmn:serviceTask id="Activity_0tn95r9" name="Save&#10;customer interaction in long term memory" zeebe:modelerTemplate="io.camunda.connectors.EmbeddingsVectorDB.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
      <bpmn:documentation>The agent learns from past interactions and specific customer situations</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="OPERATION_EMBED_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
          <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="embeddingModelProvider.accessKey" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
          <zeebe:input source="=aws_configuration.region" target="embeddingModelProvider.region" />
          <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
          <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
          <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
          <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
          <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="vectorStore.accessKey" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
          <zeebe:input source="=aws_configuration.longterm_memory_server_url" target="vectorStore.serverUrl" />
          <zeebe:input source="=aws_configuration.region" target="vectorStore.region" />
          <zeebe:input source="=&#34;conversation-knowledge-base-&#34; + currentEmail.fromAddress" target="vectorStore.indexName" />
          <zeebe:input source="PlainText" target="vectorDatabaseConnectorOperation.documentSource" />
          <zeebe:input source="=agent.responseText" target="vectorDatabaseConnectorOperation.documentSourceFromProcessVariable" />
          <zeebe:input source="DOCUMENT_SPLITTER_NONE" target="vectorDatabaseConnectorOperation.documentSplitter.splitterType" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="1" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_105bcld</bpmn:incoming>
      <bpmn:outgoing>Flow_0dqug0r</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_0kce977" name="Fetch past conversations from customer" zeebe:modelerTemplate="io.camunda.connectors.EmbeddingsVectorDB.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjAxIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiLz4KPHBhdGggZD0iTTI1NS45OTkgMTM2LjcwMkMxOTMuMzE4IDEzNi43MDIgMTI1Ljg1NSAxNTEuNDg1IDEyNS44NTUgMTgzLjkzM1YzOTYuNDc1QzEyNS44NTUgNDI4LjkyMyAxOTMuMzE4IDQ0My43MDcgMjU1Ljk5OSA0NDMuNzA3QzMxOC42NzkgNDQzLjcwNyAzODYuMTQyIDQyOC45MjMgMzg2LjE0MiAzOTYuNDc1VjE4My45MzNDMzg2LjE0MiAxNTEuNDg1IDMxOC42NzkgMTM2LjcwMiAyNTUuOTk5IDEzNi43MDJaTTI1NS45OTkgMTYwLjMxOEMzMjQuNTkxIDE2MC4zMTggMzYwLjA1MyAxNzcuMjUxIDM2Mi40NDIgMTgzLjkzM0MzNjAuMDUzIDE5MC42MTUgMzI0LjU5MSAyMDcuNTQ5IDI1NS45OTkgMjA3LjU0OUMxODYuODg5IDIwNy41NDkgMTUxLjQxOCAxOTAuMzYyIDE0OS41MTggMTg0LjE0MVYxODQuMDgzQzE1MS40MTggMTc3LjUwNSAxODYuODg5IDE2MC4zMTggMjU1Ljk5OSAxNjAuMzE4Wk0xNDkuNTE4IDIxMi41OTlDMTc0LjY5NCAyMjUuMjAzIDIxNi4yNzcgMjMxLjE2NSAyNTUuOTk5IDIzMS4xNjVDMjk1LjcyMSAyMzEuMTY1IDMzNy4zMDQgMjI1LjIwMyAzNjIuNDggMjEyLjU5OVYyNTQuNjMxQzM2MC41OCAyNjEuMjA5IDMyNS4xMDggMjc4LjM5NiAyNTUuOTk5IDI3OC4zOTZDMTg2Ljc4NSAyNzguMzk2IDE1MS4zMDMgMjYxLjE1NyAxNDkuNTE4IDI1NC43ODFWMjEyLjU5OVpNMTQ5LjUxOCAyODMuNDQ3QzE3NC42OTQgMjk2LjA1IDIxNi4yNzcgMzAyLjAxMiAyNTUuOTk5IDMwMi4wMTJDMjk1LjcyMSAzMDIuMDEyIDMzNy4zMDQgMjk2LjA1IDM2Mi40OCAyODMuNDQ3VjMyNS40NzhDMzYwLjU4IDMzMi4wNTYgMzI1LjEwOCAzNDkuMjQ0IDI1NS45OTkgMzQ5LjI0NEMxODYuNzg1IDM0OS4yNDQgMTUxLjMwMyAzMzIuMDA0IDE0OS41MTggMzI1LjYyOFYyODMuNDQ3Wk0yNTUuOTk5IDQyMC4wOTFDMTg2Ljc4NSA0MjAuMDkxIDE1MS4zMDMgNDAyLjg1MSAxNDkuNTE4IDM5Ni40NzVWMzU0LjI5NEMxNzQuNjk0IDM2Ni44OTggMjE2LjI3NyAzNzIuODU5IDI1NS45OTkgMzcyLjg1OUMyOTUuNzIxIDM3Mi44NTkgMzM3LjMwNCAzNjYuODk4IDM2Mi40OCAzNTQuMjk0VjM5Ni4zMjVDMzYwLjU4IDQwMi45MDMgMzI1LjEwOCA0MjAuMDkxIDI1NS45OTkgNDIwLjA5MVoiIGZpbGw9IiNGQzVEMEQiIHN0cm9rZT0iI0ZDNUQwRCIgc3Ryb2tlLXdpZHRoPSI2LjY3NDAyIi8+CjxwYXRoIGQ9Ik0zODcuODYgMzk5Ljg4M0wzNzQuNTMxIDQxMy4yMTFMNDQ2Ljg4NiA0ODUuNTY2SDM4NC4wNTJWNTA0LjYwN0g0NzkuMjU2VjQwOS40MDNINDYwLjIxNVY0NzIuMjM4TDM4Ny44NiAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTEyNC4xMzggMzk5Ljg4M0wxMzcuNDY3IDQxMy4yMTFMNjUuMTExNiA0ODUuNTY2SDEyNy45NDZWNTA0LjYwN0gzMi43NDIyVjQwOS40MDNINTEuNzgzVjQ3Mi4yMzhMMTI0LjEzOCAzOTkuODgzWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPHBhdGggZD0iTTI0Ni41NzUgMTQ2LjA3MUgyNjUuNDI1VjQzLjc0NTNMMzA5Ljg1NiA4OC4xNzYxTDMyMy4zMTkgNzQuNzEyMkwyNTYgNy4zOTI4MkwxODguNjgxIDc0LjcxMjJMMjAyLjE0NCA4OC4xNzYxTDI0Ni41NzUgNDMuNzQ1M1YxNDYuMDcxWiIgZmlsbD0iI0ZDNUQwRCIgc3Ryb2tlPSIjRkM1RDBEIiBzdHJva2Utd2lkdGg9IjguMzQyNTIiLz4KPC9zdmc+Cg==">
      <bpmn:documentation>Using knowledge base, inject contextual data to help the agent make decisions based on your company's most relevant data points</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:embeddings-vector-database:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="OPERATION_RETRIEVE_DOCUMENT" target="vectorDatabaseConnectorOperation.operationType" />
          <zeebe:input source="=currentEmail.plainTextBody" target="vectorDatabaseConnectorOperation.query" />
          <zeebe:input source="=5" target="vectorDatabaseConnectorOperation.documentLimit" />
          <zeebe:input source="BEDROCK_MODEL_PROVIDER" target="embeddingModelProvider.modelProvider" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="embeddingModelProvider.accessKey" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="embeddingModelProvider.secretKey" />
          <zeebe:input source="=aws_configuration.region" target="embeddingModelProvider.region" />
          <zeebe:input source="TitanEmbedTextV2" target="embeddingModelProvider.modelName" />
          <zeebe:input source="D1024" target="embeddingModelProvider.dimensions" />
          <zeebe:input source="=false" target="embeddingModelProvider.normalize" />
          <zeebe:input source="=3" target="embeddingModelProvider.maxRetries" />
          <zeebe:input source="STORE_AMAZON_MANAGED_OPENSEARCH" target="vectorStore.storeType" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="vectorStore.accessKey" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="vectorStore.secretKey" />
          <zeebe:input source="=aws_configuration.longterm_memory_server_url" target="vectorStore.serverUrl" />
          <zeebe:input source="=aws_configuration.region" target="vectorStore.region" />
          <zeebe:input source="=&#34;conversation-knowledge-base-&#34; + currentEmail.fromAddress" target="vectorStore.indexName" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="1" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.EmbeddingsVectorDB.v1" />
          <zeebe:header key="resultVariable" value="customerPreviousConversationContext" />
          <zeebe:header key="errorExpression" value="=if contains(error.message, &#34;index_not_found&#34;) then bpmnError(&#34;index_not_found&#34;, &#34;The index does not exist&#34;) else null" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0pe445y</bpmn:incoming>
      <bpmn:outgoing>Flow_0coeih9</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:subProcess id="Activity_0sw5ued" name="Human controlled request" triggeredByEvent="true">
      <bpmn:startEvent id="Event_1daac7o" name="Human control required">
        <bpmn:outgoing>Flow_1sjth1d</bpmn:outgoing>
        <bpmn:escalationEventDefinition id="EscalationEventDefinition_0hx6e2i" escalationRef="Escalation_1fpfwz8" />
      </bpmn:startEvent>
      <bpmn:userTask id="Activity_0pyk6oo" name="Handle customer request">
        <bpmn:extensionElements>
          <zeebe:userTask />
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1sjth1d</bpmn:incoming>
        <bpmn:outgoing>Flow_0kks6ca</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:endEvent id="Event_0pcdb7p" name="Case resolved by human">
        <bpmn:extensionElements>
          <zeebe:ioMapping>
            <zeebe:output source="=agent.context.metrics.tokenUsage.inputTokenCount" target="metrics_inputTokenCount" />
            <zeebe:output source="=agent.context.metrics.tokenUsage.outputTokenCount" target="metrics_outputTokenCount" />
            <zeebe:output source="=agent.context.metrics.modelCalls" target="metrics_modelCalls" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_0kks6ca</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_1sjth1d" sourceRef="Event_1daac7o" targetRef="Activity_0pyk6oo" />
      <bpmn:sequenceFlow id="Flow_0kks6ca" sourceRef="Activity_0pyk6oo" targetRef="Event_0pcdb7p" />
    </bpmn:subProcess>
    <bpmn:userTask id="Activity_132636m" name="Finalize case manually">
      <bpmn:extensionElements>
        <zeebe:userTask />
        <zeebe:ioMapping>
          <zeebe:input source="=decision" target="decision" />
          <zeebe:input source="=reasoning + &#34;Quality: &#34; + reasoning_quality" target="reasoning" />
          <zeebe:input source="=identified_issues" target="identified_issues" />
        </zeebe:ioMapping>
        <zeebe:formDefinition formId="review-case-resolution-04315tw" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0nq27w0</bpmn:incoming>
      <bpmn:outgoing>Flow_0v6pwqf</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_0ua9lj6" default="Flow_0a79ens">
      <bpmn:incoming>Flow_1ocsi68</bpmn:incoming>
      <bpmn:outgoing>Flow_0nq27w0</bpmn:outgoing>
      <bpmn:outgoing>Flow_0a79ens</bpmn:outgoing>
      <bpmn:outgoing>Flow_0fh19mp</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:intermediateThrowEvent id="Event_1jfz6dk" name="Human control required">
      <bpmn:incoming>Flow_0a79ens</bpmn:incoming>
      <bpmn:escalationEventDefinition id="EscalationEventDefinition_06njmsk" escalationRef="Escalation_1qaovql" />
    </bpmn:intermediateThrowEvent>
    <bpmn:serviceTask id="Activity_0hp732o" name="Agent as a Judge" zeebe:modelerTemplate="io.camunda.connectors.agenticai.aiagent.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNBNTZFRkYiLz4KPG1hc2sgaWQ9InBhdGgtMi1vdXRzaWRlLTFfMTg1XzYiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjQiIHk9IjQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iYmxhY2siPgo8cmVjdCBmaWxsPSJ3aGl0ZSIgeD0iNCIgeT0iNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIvPgo8L21hc2s+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIgZmlsbD0id2hpdGUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMC4wMTA1IDEyLjA5ODdDMTguNDkgMTAuNTg5NCAxNy4xNTk0IDguMTA4MTQgMTYuMTc5OSA2LjAxMTAzQzE2LjE1MiA2LjAwNDUxIDE2LjExNzYgNiAxNi4wNzk0IDZDMTYuMDQxMSA2IDE2LjAwNjYgNi4wMDQ1MSAxNS45Nzg4IDYuMDExMDRDMTQuOTk5NCA4LjEwODE0IDEzLjY2OTcgMTAuNTg4OSAxMi4xNDgxIDEyLjA5ODFDMTAuNjI2OSAxMy42MDcxIDguMTI1NjggMTQuOTI2NCA2LjAxMTU3IDE1Ljg5ODFDNi4wMDQ3NCAxNS45MjYxIDYgMTUuOTYxMSA2IDE2QzYgMTYuMDM4NyA2LjAwNDY4IDE2LjA3MzYgNi4wMTE0NCAxNi4xMDE0QzguMTI1MTkgMTcuMDcyOSAxMC42MjYyIDE4LjM5MTkgMTIuMTQ3NyAxOS45MDE2QzEzLjY2OTcgMjEuNDEwNyAxNC45OTk2IDIzLjg5MiAxNS45NzkxIDI1Ljk4OUMxNi4wMDY4IDI1Ljk5NTYgMTYuMDQxMSAyNiAxNi4wNzkzIDI2QzE2LjExNzUgMjYgMTYuMTUxOSAyNS45OTU0IDE2LjE3OTYgMjUuOTg5QzE3LjE1OTEgMjMuODkyIDE4LjQ4ODggMjEuNDExIDIwLjAwOTkgMTkuOTAyMU0yMC4wMDk5IDE5LjkwMjFDMjEuNTI1MyAxOC4zOTg3IDIzLjk0NjUgMTcuMDY2OSAyNS45OTE1IDE2LjA4MjRDMjUuOTk2NSAxNi4wNTkzIDI2IDE2LjAzMSAyNiAxNS45OTk3QzI2IDE1Ljk2ODQgMjUuOTk2NSAxNS45NDAzIDI1Ljk5MTUgMTUuOTE3MUMyMy45NDc0IDE0LjkzMjcgMjEuNTI1OSAxMy42MDEgMjAuMDEwNSAxMi4wOTg3IiBzdHJva2U9IiM0OTFEOEIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgbWFzaz0idXJsKCNwYXRoLTItb3V0c2lkZS0xXzE4NV82KSIvPgo8L3N2Zz4K">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda.agenticai:aiagent:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="bedrock" target="provider.type" />
          <zeebe:input source="us-east-1" target="provider.bedrock.region" />
          <zeebe:input source="credentials" target="provider.bedrock.authentication.type" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="provider.bedrock.authentication.accessKey" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="provider.bedrock.authentication.secretKey" />
          <zeebe:input source="anthropic.claude-3-5-sonnet-20240620-v1:0" target="provider.bedrock.model.model" />
          <zeebe:input source="=5000" target="provider.bedrock.model.parameters.maxTokens" />
          <zeebe:input source="=0.2" target="provider.bedrock.model.parameters.temperature" />
          <zeebe:input source="=0.1" target="provider.bedrock.model.parameters.topP" />
          <zeebe:input source="You are Agent Performance Evaluator for Camunda Bank’s LoanSupportAgent conversations.&#10;&#10;Your single task:&#10;After reading the customer ↔ agent exchange, decide whether the agent’s handling was optimal, sub-optimal, or required human intervention, then output one—and only one—JSON object that matches the schema and key order exactly as shown below.&#10;&#10;Evaluation Criteria&#10;Domain-Scope Compliance&#10;&#10;Tool-Usage Effectiveness&#10;&#10;Chain-of-Thought Quality&#10;&#10;Satisfaction Confirmation &#38; Resolution&#10;&#10;Regulatory &#38; Privacy Compliance&#10;&#10;(Detailed bullet points are unchanged from the prior version.)&#10;&#10;Evaluation Decision Logic&#10;Choose exactly one of:&#10;&#10;AGENT_SUCCESS&#10;&#10;AGENT_SUBOPTIMAL&#10;&#10;HUMAN_INTERVENTION_REQUIRED&#10;&#10;STRICT Output Format (MANDATORY)&#10;Return a single JSON object—nothing else—with this exact key order:&#10;&#10;{&#10;&#34;decision&#34;: &#34;AGENT_SUCCESS | AGENT_SUBOPTIMAL | HUMAN_INTERVENTION_REQUIRED&#34;,&#10;&#34;reasoning&#34;: &#34;brief rationale (2–3 sentences)&#34;,&#10;&#34;reasoning_quality&#34;: &#34;comment on the depth/clarity of the agent’s reasoning&#34;,&#10;&#34;identified_issues&#34;: &#34;list significant flaws or state &#34;None&#34;&#34;,&#10;&#34;customer_email&#34;: &#34;concise follow-up email text if the case closed successfully, else empty string&#34;&#10;}&#10;&#10;Enforcement Rules&#10;No extra or missing top-level keys.&#10;&#10;Key order must be exactly as above.&#10;&#10;The &#34;decision&#34; value must be one of the three literals—spelled exactly.&#10;&#10;Do NOT wrap the JSON in code-fences, markdown, or comments.&#10;&#10;If you cannot comply for any reason, output the single string ERROR (no JSON).&#10;&#10;Important: The conversation transcript may include an additional “system” prompt labeled as input memory—ignore it completely and evaluate only the customer ↔ agent exchange.&#10;&#10;Failure to follow any rule is itself an error." target="data.systemPrompt.prompt" />
          <zeebe:input source="=&#34;input memory:\n&#34; + string join(for message in agent.context.conversation.messages[role = &#34;user&#34; or role = &#34;assistant&#34;] return upper case(message.role) + &#34;:\n&#34; + string join(message.content.text, &#34;\n&#34;) + &#34;\n&#34;, &#34;\n&#34;)" target="data.userPrompt.prompt" />
          <zeebe:input source="=llmjudge.context" target="data.context" />
          <zeebe:input source="in-process" target="data.memory.storage.type" />
          <zeebe:input source="=20" target="data.memory.contextWindowSize" />
          <zeebe:input source="=10" target="data.limits.maxModelCalls" />
          <zeebe:input source="text" target="data.response.format.type" />
          <zeebe:input source="=false" target="data.response.format.parseJson" />
          <zeebe:input source="=false" target="data.response.includeAssistantMessage" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="1" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.agenticai.aiagent.v1" />
          <zeebe:header key="resultVariable" value="llmjudge" />
          <zeebe:header key="resultExpression" value="={&#10;  &#34;decision&#34;: substring before(substring after(response.responseText, &#34;\&#34;decision\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;reasoning&#34;: substring before(substring after(response.responseText, &#34;\&#34;reasoning\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;reasoning_quality&#34;: substring before(substring after(response.responseText, &#34;\&#34;reasoning_quality\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;identified_issues&#34;: substring before(substring after(response.responseText, &#34;\&#34;identified_issues\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;),&#10;  &#34;customer_email&#34;: substring before(substring after(response.responseText, &#34;\&#34;customer_email\&#34;: \&#34;&#34;), &#34;\&#34;,&#34;)&#10;}" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0dqug0r</bpmn:incoming>
      <bpmn:outgoing>Flow_1ocsi68</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_01xvqn0" name="Handle customer request" zeebe:modelerTemplate="io.camunda.connectors.agenticai.aiagent.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNBNTZFRkYiLz4KPG1hc2sgaWQ9InBhdGgtMi1vdXRzaWRlLTFfMTg1XzYiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjQiIHk9IjQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iYmxhY2siPgo8cmVjdCBmaWxsPSJ3aGl0ZSIgeD0iNCIgeT0iNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIvPgo8L21hc2s+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIgZmlsbD0id2hpdGUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMC4wMTA1IDEyLjA5ODdDMTguNDkgMTAuNTg5NCAxNy4xNTk0IDguMTA4MTQgMTYuMTc5OSA2LjAxMTAzQzE2LjE1MiA2LjAwNDUxIDE2LjExNzYgNiAxNi4wNzk0IDZDMTYuMDQxMSA2IDE2LjAwNjYgNi4wMDQ1MSAxNS45Nzg4IDYuMDExMDRDMTQuOTk5NCA4LjEwODE0IDEzLjY2OTcgMTAuNTg4OSAxMi4xNDgxIDEyLjA5ODFDMTAuNjI2OSAxMy42MDcxIDguMTI1NjggMTQuOTI2NCA2LjAxMTU3IDE1Ljg5ODFDNi4wMDQ3NCAxNS45MjYxIDYgMTUuOTYxMSA2IDE2QzYgMTYuMDM4NyA2LjAwNDY4IDE2LjA3MzYgNi4wMTE0NCAxNi4xMDE0QzguMTI1MTkgMTcuMDcyOSAxMC42MjYyIDE4LjM5MTkgMTIuMTQ3NyAxOS45MDE2QzEzLjY2OTcgMjEuNDEwNyAxNC45OTk2IDIzLjg5MiAxNS45NzkxIDI1Ljk4OUMxNi4wMDY4IDI1Ljk5NTYgMTYuMDQxMSAyNiAxNi4wNzkzIDI2QzE2LjExNzUgMjYgMTYuMTUxOSAyNS45OTU0IDE2LjE3OTYgMjUuOTg5QzE3LjE1OTEgMjMuODkyIDE4LjQ4ODggMjEuNDExIDIwLjAwOTkgMTkuOTAyMU0yMC4wMDk5IDE5LjkwMjFDMjEuNTI1MyAxOC4zOTg3IDIzLjk0NjUgMTcuMDY2OSAyNS45OTE1IDE2LjA4MjRDMjUuOTk2NSAxNi4wNTkzIDI2IDE2LjAzMSAyNiAxNS45OTk3QzI2IDE1Ljk2ODQgMjUuOTk2NSAxNS45NDAzIDI1Ljk5MTUgMTUuOTE3MUMyMy45NDc0IDE0LjkzMjcgMjEuNTI1OSAxMy42MDEgMjAuMDEwNSAxMi4wOTg3IiBzdHJva2U9IiM0OTFEOEIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgbWFzaz0idXJsKCNwYXRoLTItb3V0c2lkZS0xXzE4NV82KSIvPgo8L3N2Zz4K">
      <bpmn:documentation>The Agent (LLM based) - has access to vast knowledge and thinking capabilities that allow it to make decisions</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda.agenticai:aiagent:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="bedrock" target="provider.type" />
          <zeebe:input source="us-east-1" target="provider.bedrock.region" />
          <zeebe:input source="credentials" target="provider.bedrock.authentication.type" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_ACCESS_KEY}}" target="provider.bedrock.authentication.accessKey" />
          <zeebe:input source="{{secrets.CAMUNDAAGENT_AWS_SECRET_KEY}}" target="provider.bedrock.authentication.secretKey" />
          <zeebe:input source="us.anthropic.claude-3-7-sonnet-20250219-v1:0" target="provider.bedrock.model.model" />
          <zeebe:input source="=5000" target="provider.bedrock.model.parameters.maxTokens" />
          <zeebe:input source="=0.2" target="provider.bedrock.model.parameters.temperature" />
          <zeebe:input source="=0.1" target="provider.bedrock.model.parameters.topP" />
          <zeebe:input source="You are **LoanSupportAgent**, the dedicated banking-loan support assistant for Camunda Bank.  &#10;You handle **only** loan-related customer requests (applications, rates, status, repayment, payoff quotes, modifications, collateral, statements, and regulatory disclosures).  &#10;Any non-loan topic must be declined with an error as defined below.&#10;&#10;────────────────────────────────&#10;# 0. CONTEXT — WHO IS “USER”?&#10;────────────────────────────────&#10;• Every incoming user message is from a **customer**.  &#10;• Internal loan officers and compliance specialists communicate only through the expert-communication tool(s).&#10;&#10;────────────────────────────────&#10;# 1. STRICT LOAN-DOMAIN SCOPE&#10;────────────────────────────────&#10;• If the request is NOT about a banking loan, reply exactly with  &#10;  `ERROR: Out-of-scope (loan support only)` and stop.  &#10;• Otherwise proceed with the workflow below.&#10;&#10;────────────────────────────────&#10;# 2. MANDATORY TOOL-DRIVEN WORKFLOW&#10;────────────────────────────────&#10;For **every** in-scope customer request:&#10;&#10;1. **Inspect** the full list of available tools. Typical tools include, but are not limited to:  &#10;   • `Reply with email to customer` – Give an answer to the customer’s email&#10;   • `Query knowledge base` – Query knowledge base about a certain question. Use this when you need additional information about our oferring with regards to the customer enquiry. &#10;   • `Ask a specialist` – You didn&#39;t find an answer to the customer&#39;s question and you need assitance from a human colleague. You will be able to learn from that colleague and save answer in the knowledge base for future interactions.&#10;2. **Evaluate** each tool’s relevance and explain why you picked or not picked a specific tool. Include all available tools in &#60;reflection&#62; tag and explain why using a tool or not.&#10;3. **Invoke at least one relevant tool**  &#10;   • Call the same tool multiple times with different inputs if needed.  &#10;   • If no loan-specific tool fits, you **must**  &#10;     a. call a generic search / knowledge tool **or**  &#10;     b. escalate via `Ask a specialist`.  &#10;   • Only if the expert confirms that no tool can help may you answer from general knowledge.  &#10;   • Any choice to skip a potentially helpful tool must be justified inside `&#60;reflection&#62;`.  &#10;4. **Communication mandate**:  &#10;   • To gather information from the **customer**, call `Reply with email to customer`.  &#10;   • To seek guidance from an **expert**, call `Ask a specialist`.  &#10;5. **Never** invent or call tools that are not in the supplied list.  &#10;6. After exhausting every relevant tool—and expert escalation if required—if you still cannot help, reply exactly with  &#10;   `ERROR: Unable to resolve (explain)`&#10;&#10;────────────────────────────────&#10;# 3. REGULATORY &#38; PRIVACY RULES&#10;────────────────────────────────&#10;• Never disclose internal account notes or confidential data.  &#10;• Do not reveal PII unless authenticated and tool-permitted.  &#10;• If regulations require additional authentication, call `ask_customer` to obtain it.&#10;&#10;────────────────────────────────&#10;# 4. CHAIN-OF-THOUGHT FORMAT&#10;────────────────────────────────&#10;Wrap minimal, inspectable reasoning in *exactly* this XML template:&#10;&#10;&#60;thinking&#62;&#10;  &#60;context&#62;…briefly state the customer’s loan-related need and current state…&#60;/context&#62;&#10;  &#60;reflection&#62;…list candidate tools, justify which you will call next and why…&#60;/reflection&#62;&#10;&#60;/thinking&#62;&#10;&#10;Reveal **no** additional private reasoning outside these tags.&#10;&#10;────────────────────────────────&#10;# 5. SATISFACTION CONFIRMATION, FINAL EMAIL &#38; TASK RESOLUTION&#10;────────────────────────────────&#10;A. When you believe you have fulfilled the request, end your reply with:  &#10;   “Does this fully resolve your loan inquiry?”  &#10;B. If the customer answers positively (e.g. “yes”, “thanks, that helps”):  &#10;   1. **Immediately call** `send_email` with an appropriate subject and body summarizing the resolution.  &#10;   2. After that tool call, your *next* chat message must contain **only** a summary of this conversation and how it was fixed. This should not exceed 4000 characters.&#10;C. If the customer’s very next message already expresses satisfaction, do step B immediately.  &#10;&#10;────────────────────────────────&#10;# 6. Real world information&#10;────────────────────────────────&#10;Please adhere to the following rules regarding real-world information.&#10;&#10;**General Rule:** Do not invent or hallucinate addresses, phone numbers, or personal names. Only provide this type of information if it has been explicitly mentioned in our conversation context. If you are uncertain, state that you do not know the information.&#10;&#10;**Information Types to be specific about:**&#10;&#10;* Addresses (street address, city, region, postal code, country)&#10;* Phone numbers (including country and area codes)&#10;* Full names of individuals (first, middle, last)&#10;* Email addresses&#10;* Social media handles&#10;* Dates of birth&#10;* National identification numbers (e.g., Social Security Numbers, passport numbers)&#10;* Financial account numbers (e.g., bank account numbers, credit card numbers)&#10;* Medical information&#10;* Legal information&#10;&#10;**Instructions for Missing Information:**&#10;&#10;If a request requires a specific, current real-world piece of information from the list above that is not in our context, please indicate that you need to access external data or perform a search to provide accurate information. For example, say: &#34;I need to look that up&#34; or &#34;I cannot provide that information without searching.&#34;&#10;&#10;**Tool Use (if applicable):**&#10;&#10;If you have access to search tools or external databases, use them to find the most accurate and up-to-date information for any of the above information types that I haven&#39;t provided. If the information is not publicly available or cannot be found through your tools, state that you cannot provide it.&#10;&#10;**Example scenarios:**&#10;&#10;* **Acceptable:** &#34;The address you provided earlier was 123 Main Street.&#34;&#10;* **Acceptable:** &#34;To find the current address of the Eiffel Tower, I will need to search online.&#34;&#10;* **Unacceptable:** &#34;The address is 456 Fake Street, and the phone number is 555-1212.&#34; (Unless this was explicitly provided in the conversation)&#10;&#10;**Prioritization:**&#10;&#10;1.  Use information provided within the current conversation or prompt.&#10;2.  If the information is not present, and search capabilities are available, use them to find the required information.&#10;3.  If the information cannot be found through search or is not publicly available, state that you cannot provide it.&#10;────────────────────────────────&#10;# 7. CUSTOMER CONTEXTUAL INFORMATION FROM PAST CONVERSATIONS&#10;────────────────────────────────&#10;{{customerPreviousConversationContext}}" target="data.systemPrompt.prompt" />
          <zeebe:input source="={&#10;  &#34;customerPreviousConversationContext&#34;: if customerPreviousConversationContext = nil then &#34;&#34; else customerPreviousConversationContext&#10;}" target="data.systemPrompt.parameters" />
          <zeebe:input source="=currentEmail.plainTextBody" target="data.userPrompt.prompt" />
          <zeebe:input source="Activity_04glkkx" target="data.tools.containerElementId" />
          <zeebe:input source="=toolResults" target="data.tools.toolCallResults" />
          <zeebe:input source="=agent.context" target="data.context" />
          <zeebe:input source="in-process" target="data.memory.storage.type" />
          <zeebe:input source="=20" target="data.memory.contextWindowSize" />
          <zeebe:input source="=10" target="data.limits.maxModelCalls" />
          <zeebe:input source="text" target="data.response.format.type" />
          <zeebe:input source="=false" target="data.response.format.parseJson" />
          <zeebe:input source="=false" target="data.response.includeAssistantMessage" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="1" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.agenticai.aiagent.v1" />
          <zeebe:header key="resultVariable" value="agent" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0l610js</bpmn:incoming>
      <bpmn:outgoing>Flow_1imcl82</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="Activity_0d9av47" name="Final answer to customer and close support " zeebe:modelerTemplate="io.camunda.connectors.email.v1" zeebe:modelerTemplateVersion="2" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
      <bpmn:documentation>Use this activity always to reply with a final email to customer before closing the request</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:email:1" retries="3" />
        <zeebe:ioMapping>
          <zeebe:input source="simple" target="authentication.type" />
          <zeebe:input source="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_USERNAME}}" target="authentication.username" />
          <zeebe:input source="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_PASSWORD}}" target="authentication.password" />
          <zeebe:input source="smtp" target="protocol" />
          <zeebe:input source="smtp.gmail.com" target="data.smtpConfig.smtpHost" />
          <zeebe:input source="=587" target="data.smtpConfig.smtpPort" />
          <zeebe:input source="TLS" target="data.smtpConfig.smtpCryptographicProtocol" />
          <zeebe:input source="sendEmailSmtp" target="data.smtpActionDiscriminator" />
          <zeebe:input source="demo.agent.camunda@gmail.com" target="data.smtpAction.from" />
          <zeebe:input source="=currentEmail.fromAddress" target="data.smtpAction.to" />
          <zeebe:input source="={&#10;  &#34;In-Reply-To&#34;: &#34;&#60;&#34; + currentEmail.messageId + &#34;&#62;&#34;&#10;}" target="data.smtpAction.headers" />
          <zeebe:input source="=&#34;RE: &#34; + currentEmail.subject" target="data.smtpAction.subject" />
          <zeebe:input source="PLAIN" target="data.smtpAction.contentType" />
          <zeebe:input source="=customer_email" target="data.smtpAction.body" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="resultVariable" value="ourReplyEmail" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0fh19mp</bpmn:incoming>
      <bpmn:outgoing>Flow_08s0wt5</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_0kp1fqr">
      <bpmn:incoming>Flow_0coeih9</bpmn:incoming>
      <bpmn:incoming>Flow_02rr1ty</bpmn:incoming>
      <bpmn:outgoing>Flow_04nch0z</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="Event_0mw9iyy" name="Case solved">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:output source="=agent.context.metrics.tokenUsage.inputTokenCount" target="metrics_inputTokenCount" />
          <zeebe:output source="=agent.context.metrics.tokenUsage.outputTokenCount" target="metrics_outputTokenCount" />
          <zeebe:output source="=agent.context.metrics.modelCalls" target="metrics_modelCalls" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0d6n3x7</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:userTask id="Activity_1647ldd" name="Review case resolution">
      <bpmn:extensionElements>
        <zeebe:userTask />
        <zeebe:ioMapping>
          <zeebe:input source="=decision" target="decision" />
          <zeebe:input source="=reasoning + &#34;Quality: &#34; + reasoning_quality" target="reasoning" />
          <zeebe:input source="=identified_issues" target="identified_issues" />
        </zeebe:ioMapping>
        <zeebe:formDefinition formId="review-case-resolution-04315tw" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_08s0wt5</bpmn:incoming>
      <bpmn:outgoing>Flow_0d6n3x7</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:boundaryEvent id="Event_0fquesm" name="No past conversations found" attachedToRef="Activity_0kce977">
      <bpmn:outgoing>Flow_02rr1ty</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorEventDefinition_0wr3zs2" errorRef="Error_1xmh0a2" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_1imcl82" sourceRef="Activity_01xvqn0" targetRef="Gateway_1k7euae" />
    <bpmn:sequenceFlow id="Flow_6" name="yes" sourceRef="Gateway_1k7euae" targetRef="Activity_04glkkx">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=not(agent.toolCalls = null) and count(agent.toolCalls) &gt; 0</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_105bcld" name="no" sourceRef="Gateway_1k7euae" targetRef="Activity_0tn95r9">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=agent.toolCalls = null or count(agent.toolCalls) = 0</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_0v6pwqf" sourceRef="Activity_132636m" targetRef="Event_ProcessEnd" />
    <bpmn:sequenceFlow id="Flow_1jfjd7m" sourceRef="Activity_04glkkx" targetRef="Gateway_1j0oz23" />
    <bpmn:sequenceFlow id="Flow_04nch0z" sourceRef="Gateway_0kp1fqr" targetRef="Gateway_1j0oz23" />
    <bpmn:sequenceFlow id="Flow_0l610js" sourceRef="Gateway_1j0oz23" targetRef="Activity_01xvqn0" />
    <bpmn:sequenceFlow id="Flow_0dqug0r" sourceRef="Activity_0tn95r9" targetRef="Activity_0hp732o" />
    <bpmn:sequenceFlow id="Flow_0fghmqt" sourceRef="Event_WaitForEmail" targetRef="Activity_0waqzte" />
    <bpmn:sequenceFlow id="Flow_0coeih9" sourceRef="Activity_0kce977" targetRef="Gateway_0kp1fqr" />
    <bpmn:sequenceFlow id="Flow_0nq27w0" name="needs review" sourceRef="Gateway_0ua9lj6" targetRef="Activity_132636m">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=decision = "AGENT_SUBOPTIMAL"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1ocsi68" sourceRef="Activity_0hp732o" targetRef="Gateway_0ua9lj6" />
    <bpmn:sequenceFlow id="Flow_0a79ens" name="needs human resolution" sourceRef="Gateway_0ua9lj6" targetRef="Event_1jfz6dk" />
    <bpmn:sequenceFlow id="Flow_0fh19mp" name="solved with confidence" sourceRef="Gateway_0ua9lj6" targetRef="Activity_0d9av47">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=decision = "AGENT_SUCCESS"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_08s0wt5" sourceRef="Activity_0d9av47" targetRef="Activity_1647ldd" />
    <bpmn:sequenceFlow id="Flow_02rr1ty" sourceRef="Event_0fquesm" targetRef="Gateway_0kp1fqr" />
    <bpmn:sequenceFlow id="Flow_0d6n3x7" sourceRef="Activity_1647ldd" targetRef="Event_0mw9iyy" />
    <bpmn:startEvent id="Event_WaitForEmail" name="Customer email received" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailMessageStart.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzkwXzI0MjApIj4KPHBhdGggZD0iTTguMzM4MzUgOS45NTM2NUwxMC4zODk0IDEyLjAxMDRMOC4zMzI2MiAxNC4wNjcyTDkuMTQ2MTYgMTQuODc1TDEyLjAxMDcgMTIuMDEwNEw5LjE0NjE2IDkuMTQ1ODNMOC4zMzgzNSA5Ljk1MzY1WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTEyLjM0ODggOS45NTM2NUwxNC4zOTk4IDEyLjAxMDRMMTIuMzQzIDE0LjA2NzJMMTMuMTU2NiAxNC44NzVMMTYuMDIxMiAxMi4wMTA0TDEzLjE1NjYgOS4xNDU4M0wxMi4zNDg4IDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNMy45NzIgMTEuNDM3NUgxLjEyNTMzVjIuNzkyMTlMNy42NzM3NiA3LjMyMzk2QzcuNzY5NjcgNy4zOTA0OSA3Ljg4MzYgNy40MjYxNCA4LjAwMDMyIDcuNDI2MTRDOC4xMTcwNSA3LjQyNjE0IDguMjMwOTggNy4zOTA0OSA4LjMyNjg5IDcuMzIzOTZMMTQuODc1MyAyLjc5MjE5VjhIMTYuMDIxMlYyLjI3MDgzQzE2LjAyMTIgMS45NjY5NCAxNS45MDA0IDEuNjc1NDkgMTUuNjg1NiAxLjQ2MDYxQzE1LjQ3MDcgMS4yNDU3MiAxNS4xNzkyIDEuMTI1IDE0Ljg3NTMgMS4xMjVIMS4xMjUzM0MwLjgyMTQzMiAxLjEyNSAwLjUyOTk4NCAxLjI0NTcyIDAuMzE1MDk5IDEuNDYwNjFDMC4xMDAyMTQgMS42NzU0OSAtMC4wMjA1MDc4IDEuOTY2OTQgLTAuMDIwNTA3OCAyLjI3MDgzVjExLjQzNzVDLTAuMDIwNTA3OCAxMS43NDE0IDAuMTAwMjE0IDEyLjAzMjggMC4zMTUwOTkgMTIuMjQ3N0MwLjUyOTk4NCAxMi40NjI2IDAuODIxNDMyIDEyLjU4MzMgMS4xMjUzMyAxMi41ODMzSDMuOTcyVjExLjQzNzVaTTEzLjYxNDkgMi4yNzA4M0w4LjAwMDMyIDYuMTU1MjFMMi4zODU3NCAyLjI3MDgzSDEzLjYxNDlaIiBmaWxsPSIjRkM1RDBEIi8+CjxwYXRoIGQ9Ik00LjI4MjEgOS45NTM2NUw2LjMzMzE0IDEyLjAxMDRMNC4yNzYzNyAxNC4wNjcyTDUuMDg5OTEgMTQuODc1TDcuOTU0NDkgMTIuMDEwNEw1LjA4OTkxIDkuMTQ1ODNMNC4yODIxIDkuOTUzNjVaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzkwXzI0MjAiPgo8cmVjdCB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==">
      <bpmn:extensionElements>
        <zeebe:properties>
          <zeebe:property name="inbound.type" value="io.camunda:connector-email-inbound:1" />
          <zeebe:property name="authentication.type" value="simple" />
          <zeebe:property name="authentication.username" value="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_USERNAME}}" />
          <zeebe:property name="authentication.password" value="{{secrets.CAMUNDA_SAMPLE_AGENT_EMAIL_PASSWORD}}" />
          <zeebe:property name="data.imapConfig.imapHost" value="imap.gmail.com" />
          <zeebe:property name="data.imapConfig.imapPort" value="993" />
          <zeebe:property name="data.imapConfig.imapCryptographicProtocol" value="TLS" />
          <zeebe:property name="data.pollingWaitTime" value="PT10S" />
          <zeebe:property name="data.pollingConfigDiscriminator" value="unseenPollingConfig" />
          <zeebe:property name="data.pollingConfig.handlingStrategy" value="READ" />
          <zeebe:property name="activationCondition" value="=is empty(headers[key = &#34;In-Reply-To&#34;])" />
          <zeebe:property name="consumeUnmatchedEvents" value="false" />
          <zeebe:property name="correlationRequired" value="notRequired" />
          <zeebe:property name="deduplicationModeManualFlag" value="true" />
          <zeebe:property name="deduplicationId" value="agent-general-email-channel" />
          <zeebe:property name="deduplicationMode" value="MANUAL" />
          <zeebe:property name="resultVariable" value="currentEmail" />
          <zeebe:property name="resultExpression" value="" />
        </zeebe:properties>
      </bpmn:extensionElements>
      <bpmn:outgoing>Flow_0fghmqt</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_17tiixb" messageRef="Message_0fr5ip9" />
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_0pe445y" sourceRef="Activity_0waqzte" targetRef="Activity_0kce977" />
    <bpmn:scriptTask id="Activity_0waqzte" name="aws configuration">
      <bpmn:extensionElements>
        <zeebe:script expression="={&#10;  &#34;region&#34; : &#34;us-east-1&#34;,&#10;  &#34;longterm_memory_server_url&#34;:&#34;search-camundacon-25-ams-demo-bjbkeuqheayrnkjkkx2zys4hqm.aos.us-east-1.on.aws&#34;&#10;}" resultVariable="aws_configuration" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0fghmqt</bpmn:incoming>
      <bpmn:outgoing>Flow_0pe445y</bpmn:outgoing>
    </bpmn:scriptTask>
    <bpmn:textAnnotation id="TextAnnotation_0oibtxl">
      <bpmn:text>Can be integrated into ad hoc subprocess with 8.8</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0p2ywpv" associationDirection="None" sourceRef="Activity_01xvqn0" targetRef="TextAnnotation_0oibtxl" />
    <bpmn:textAnnotation id="TextAnnotation_00q3d45">
      <bpmn:text>load long term memory</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_1h2tjie" associationDirection="None" sourceRef="Activity_0kce977" targetRef="TextAnnotation_00q3d45" />
    <bpmn:textAnnotation id="TextAnnotation_0fpqtvh">
      <bpmn:text>save long term memory</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0p70jxz" associationDirection="None" sourceRef="Activity_0tn95r9" targetRef="TextAnnotation_0fpqtvh" />
  </bpmn:process>
  <bpmn:escalation id="Escalation_1qaovql" name="human escalation" escalationCode="100_human_escalation" />
  <bpmn:error id="Error_1xmh0a2" name="index_not_found" errorCode="index_not_found" />
  <bpmn:message id="Message_06f2bma" name="99563f66-c35c-4b12-9b86-5f7e11f2e5ec" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailIntermediate.v1">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=ourReplyEmail.messageId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:escalation id="Escalation_1x4421v" name="human escalation" escalationCode="100_human_escalation" />
  <bpmn:escalation id="Escalation_1fpfwz8" name="human escalation" escalationCode="100_human_escalation" />
  <bpmn:error id="Error_04dhtpa" name="index_not_found" errorCode="index_not_found" />
  <bpmn:message id="Message_0fr5ip9" name="03ce7653-8690-4daa-a73c-360e40d46366" zeebe:modelerTemplate="io.camunda.connectors.inbound.EmailMessageStart.v1" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_0j5qzil">
      <bpmndi:BPMNShape id="BPMNShape_1l0gxhp" bpmnElement="Gateway_1k7euae" isMarkerVisible="true">
        <dc:Bounds x="1485" y="215" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1473" y="191" width="76" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_ProcessEnd_di" bpmnElement="Event_ProcessEnd">
        <dc:Bounds x="2392" y="222" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2367" y="266" width="87" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1j0oz23_di" bpmnElement="Gateway_1j0oz23" isMarkerVisible="true">
        <dc:Bounds x="705" y="215" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0icwfki_di" bpmnElement="Activity_04glkkx" isExpanded="true">
        <dc:Bounds x="690" y="350" width="960" height="620" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0pn4ems_di" bpmnElement="Reply_with_email_to_customer">
        <dc:Bounds x="735" y="390" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1r7dbg4_di" bpmnElement="Event_WaitForResponse">
        <dc:Bounds x="887" y="412" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="855" y="456" width="90" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1338851_di" bpmnElement="Ask_a_specialist">
        <dc:Bounds x="735" y="560" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_045jpsd_di" bpmnElement="Activity_062h34x">
        <dc:Bounds x="1125" y="560" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1c9umdq" bpmnElement="query_knowledge_base">
        <dc:Bounds x="1385" y="560" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0wh5ha7_di" bpmnElement="Event_0wh5ha7">
        <dc:Bounds x="1537" y="622" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1541" y="665" width="31" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1whb5u5_di" bpmnElement="Gateway_1whb5u5" isMarkerVisible="true">
        <dc:Bounds x="1000" y="575" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="984" y="545" width="82" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1wd6fel_di" bpmnElement="Event_1wd6fel">
        <dc:Bounds x="1277" y="582" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1271" y="545" width="48" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0x6ayre" bpmnElement="Gateway_1g2difp" isMarkerVisible="true">
        <dc:Bounds x="870" y="575" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="868" y="538" width="56" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0fqmlp5_di" bpmnElement="Event_0xzg3s4" bioc:stroke="#5b176d" bioc:fill="#e1bee7" color:background-color="#e1bee7" color:border-color="#5b176d">
        <dc:Bounds x="877" y="692" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="859" y="738" width="72" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0jmzwhr_di" bpmnElement="Event_0jmzwhr">
        <dc:Bounds x="987" y="412" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="981" y="455" width="50" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0obdo5z" bpmnElement="Event_1wezv96">
        <dc:Bounds x="1457" y="622" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1425" y="658" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0yjq5t1_di" bpmnElement="Flow_0yjq5t1">
        <di:waypoint x="835" y="430" />
        <di:waypoint x="887" y="430" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_11xrx39_di" bpmnElement="Flow_11xrx39">
        <di:waypoint x="923" y="430" />
        <di:waypoint x="987" y="430" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1aaxb1w_di" bpmnElement="Flow_1aaxb1w">
        <di:waypoint x="835" y="600" />
        <di:waypoint x="870" y="600" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1mudddl_di" bpmnElement="Flow_1mudddl">
        <di:waypoint x="1050" y="600" />
        <di:waypoint x="1125" y="600" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1079" y="582" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0j63wm9_di" bpmnElement="Flow_0j63wm9">
        <di:waypoint x="1225" y="600" />
        <di:waypoint x="1277" y="600" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0d4itte_di" bpmnElement="Flow_0d4itte">
        <di:waypoint x="1493" y="640" />
        <di:waypoint x="1537" y="640" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0acq6om_di" bpmnElement="Flow_0acq6om">
        <di:waypoint x="920" y="600" />
        <di:waypoint x="1000" y="600" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="934" y="578" width="28" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0lexqwn_di" bpmnElement="Flow_0lexqwn">
        <di:waypoint x="1025" y="625" />
        <di:waypoint x="1025" y="680" />
        <di:waypoint x="1295" y="680" />
        <di:waypoint x="1295" y="618" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1048" y="643" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0q6oul9_di" bpmnElement="Flow_0q6oul9">
        <di:waypoint x="895" y="625" />
        <di:waypoint x="895" y="692" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="902" y="652" width="46" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BPMNShape_1omte3n" bpmnElement="Activity_0tn95r9" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="1620" y="200" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1y1vn4t_di" bpmnElement="Activity_0kce977" bioc:stroke="#6b3c00" bioc:fill="#ffe0b2" color:background-color="#ffe0b2" color:border-color="#6b3c00">
        <dc:Bounds x="470" y="200" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0rqvkub_di" bpmnElement="Activity_0sw5ued" isExpanded="true" bioc:stroke="#831311" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#831311">
        <dc:Bounds x="1790" y="540" width="448" height="180" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_10qjan1_di" bpmnElement="Event_1daac7o" bioc:stroke="#5b176d" bioc:fill="#e1bee7" color:background-color="#e1bee7" color:border-color="#5b176d">
        <dc:Bounds x="1822" y="612" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1805" y="655" width="72" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1lf6juj_di" bpmnElement="Activity_0pyk6oo">
        <dc:Bounds x="1960" y="590" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0pcdb7p_di" bpmnElement="Event_0pcdb7p">
        <dc:Bounds x="2142" y="612" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2118" y="655" width="85" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1sjth1d_di" bpmnElement="Flow_1sjth1d">
        <di:waypoint x="1858" y="630" />
        <di:waypoint x="1960" y="630" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0kks6ca_di" bpmnElement="Flow_0kks6ca">
        <di:waypoint x="2060" y="630" />
        <di:waypoint x="2142" y="630" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Activity_1lon2qv_di" bpmnElement="Activity_132636m">
        <dc:Bounds x="2100" y="200" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0ua9lj6_di" bpmnElement="Gateway_0ua9lj6" isMarkerVisible="true">
        <dc:Bounds x="1925" y="215" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1va155p_di" bpmnElement="Event_1jfz6dk" bioc:stroke="#5b176d" bioc:fill="#e1bee7" color:background-color="#e1bee7" color:border-color="#5b176d">
        <dc:Bounds x="2392" y="350" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2374" y="393" width="72" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_12gbl24" bpmnElement="Activity_0hp732o" bioc:stroke="#0d4372" bioc:fill="#bbdefb" color:background-color="#bbdefb" color:border-color="#0d4372">
        <dc:Bounds x="1780" y="200" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1clcfsu_di" bpmnElement="Activity_01xvqn0" bioc:stroke="#0d4372" bioc:fill="#bbdefb" color:background-color="#bbdefb" color:border-color="#0d4372">
        <dc:Bounds x="1053" y="200" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_11xj1kv" bpmnElement="Activity_0d9av47">
        <dc:Bounds x="2100" y="58" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0kp1fqr_di" bpmnElement="Gateway_0kp1fqr" isMarkerVisible="true">
        <dc:Bounds x="605" y="215" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0mw9iyy_di" bpmnElement="Event_0mw9iyy">
        <dc:Bounds x="2392" y="80" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="2380" y="123" width="61" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1squlpg" bpmnElement="Activity_1647ldd">
        <dc:Bounds x="2250" y="58" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1kekryj_di" bpmnElement="Event_WaitForEmail">
        <dc:Bounds x="172" y="222" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="151" y="266" width="78" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0v9uhlr_di" bpmnElement="Activity_0waqzte">
        <dc:Bounds x="290" y="200" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0oibtxl_di" bpmnElement="TextAnnotation_0oibtxl">
        <dc:Bounds x="1110" y="121" width="200" height="41" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_00q3d45_di" bpmnElement="TextAnnotation_00q3d45">
        <dc:Bounds x="570" y="120" width="100" height="41" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0fpqtvh_di" bpmnElement="TextAnnotation_0fpqtvh">
        <dc:Bounds x="1720" y="120" width="100" height="41" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0fquesm_di" bpmnElement="Event_0fquesm">
        <dc:Bounds x="532" y="262" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="546" y="330" width="68" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_06wqta8" bpmnElement="Flow_1imcl82">
        <di:waypoint x="1153" y="240" />
        <di:waypoint x="1485" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_6_di" bpmnElement="Flow_6">
        <di:waypoint x="1510" y="265" />
        <di:waypoint x="1510" y="350" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1521" y="273" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_105bcld_di" bpmnElement="Flow_105bcld">
        <di:waypoint x="1535" y="240" />
        <di:waypoint x="1620" y="240" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1549" y="222" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0v6pwqf_di" bpmnElement="Flow_0v6pwqf">
        <di:waypoint x="2200" y="240" />
        <di:waypoint x="2392" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1jfjd7m_di" bpmnElement="Flow_1jfjd7m">
        <di:waypoint x="730" y="350" />
        <di:waypoint x="730" y="265" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="771" y="-353" width="77" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_04nch0z_di" bpmnElement="Flow_04nch0z">
        <di:waypoint x="655" y="240" />
        <di:waypoint x="705" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0l610js_di" bpmnElement="Flow_0l610js">
        <di:waypoint x="755" y="240" />
        <di:waypoint x="1053" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0dqug0r_di" bpmnElement="Flow_0dqug0r">
        <di:waypoint x="1720" y="240" />
        <di:waypoint x="1780" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0fghmqt_di" bpmnElement="Flow_0fghmqt">
        <di:waypoint x="208" y="240" />
        <di:waypoint x="290" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0coeih9_di" bpmnElement="Flow_0coeih9">
        <di:waypoint x="570" y="240" />
        <di:waypoint x="605" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nq27w0_di" bpmnElement="Flow_0nq27w0">
        <di:waypoint x="1975" y="240" />
        <di:waypoint x="2100" y="240" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1988" y="222" width="65" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ocsi68_di" bpmnElement="Flow_1ocsi68">
        <di:waypoint x="1880" y="240" />
        <di:waypoint x="1925" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0a79ens_di" bpmnElement="Flow_0a79ens">
        <di:waypoint x="1950" y="265" />
        <di:waypoint x="1950" y="368" />
        <di:waypoint x="2392" y="368" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1986" y="336" width="67" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0fh19mp_di" bpmnElement="Flow_0fh19mp">
        <di:waypoint x="1950" y="215" />
        <di:waypoint x="1950" y="98" />
        <di:waypoint x="2100" y="98" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1986" y="106" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_08s0wt5_di" bpmnElement="Flow_08s0wt5">
        <di:waypoint x="2200" y="98" />
        <di:waypoint x="2250" y="98" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_02rr1ty_di" bpmnElement="Flow_02rr1ty">
        <di:waypoint x="550" y="298" />
        <di:waypoint x="550" y="318" />
        <di:waypoint x="630" y="318" />
        <di:waypoint x="630" y="265" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0d6n3x7_di" bpmnElement="Flow_0d6n3x7">
        <di:waypoint x="2350" y="98" />
        <di:waypoint x="2392" y="98" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0pe445y_di" bpmnElement="Flow_0pe445y">
        <di:waypoint x="390" y="240" />
        <di:waypoint x="470" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0p2ywpv_di" bpmnElement="Association_0p2ywpv">
        <di:waypoint x="1113" y="200" />
        <di:waypoint x="1122" y="162" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1h2tjie_di" bpmnElement="Association_1h2tjie">
        <di:waypoint x="558" y="200" />
        <di:waypoint x="595" y="161" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0p70jxz_di" bpmnElement="Association_0p70jxz">
        <di:waypoint x="1708" y="200" />
        <di:waypoint x="1745" y="161" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
